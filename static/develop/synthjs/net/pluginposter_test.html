<!DOCTYPE html>
<html>
<head>
<title>synthjs Unit Tests</title>
<script src="../../closure/goog/base.js"></script>
<script src="../../deps.js"></script>
<script>
	goog.require("goog.testing.jsunit");
	goog.require("goog.testing.AsyncTestCase");
	
	goog.require("synthjs.utility.BlobBuilder");
	goog.require("synthjs.net.PluginPoster");
	goog.require("synthjs.utility.AjaxDeferred");
</script>
</head>
<body>
<script>

var asyncTestCase = new goog.testing.AsyncTestCase.createAndInstall();
var D = synthjs.utility.AjaxDeferred;

function setUp() {

}

function tearDown() {

}

function testTextPost() {
	
	var plugincode = "jstestplugin",
		updateApi = "/sdk/plugin/"+plugincode+"/",
		name = 'test.js', content = 'status=oka;',
		getUrl = "/sdk/plugin/"+plugincode+"/"+name,
		getUri = new goog.Uri(getUrl);
		
	var bb = new synthjs.utility.BlobBuilder();
	bb.append(content);
	var b = bb.getBlob("text/plain");
	
	var pp = new synthjs.net.PluginPoster(updateApi);
	pp.addFile(name, b);
	var d = pp.getRequestDeferred();
	d.assocChainDeferred(
		new synthjs.utility.AjaxDeferred(
			getUri.toString(), {
				success: function(e){
					assertEquals( e.getResponseText(), content );
				}
			}
		)
	).addCallback(function(){
		asyncTestCase.continueTesting();
	})
	
	d.callback();
	
	asyncTestCase.waitForAsync();
}

function testTextPostDeep() {
	
	var plugincode = "jstestplugin",
		updateApi = "/sdk/plugin/"+plugincode+"/",
		name = 'subdir/test.js', content = 'status=oka;',
		getUrl = "/sdk/plugin/"+plugincode+"/"+name,
		getUri = new goog.Uri(getUrl);
		
	var bb = new synthjs.utility.BlobBuilder();
	bb.append(content);
	var b = bb.getBlob("text/plain");
	
	var pp = new synthjs.net.PluginPoster(updateApi);
	pp.addFile(name, b);
	var d = pp.getRequestDeferred();
	d.assocChainDeferred(
		new synthjs.utility.AjaxDeferred(
			getUri.toString(), {
				success: function(e){
					assertEquals( e.getResponseText(), content );
				}
			}
		)
	).addCallback(function(){
		asyncTestCase.continueTesting();
	})
	
	d.callback();
	
	asyncTestCase.waitForAsync();
}


</script>
</body>
</html>

